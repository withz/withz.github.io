<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"withz.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="…">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity 3D">
<meta property="og:url" content="https://withz.github.io/2020/03/18/%E6%B8%B8%E6%88%8F/Unity3d/index.html">
<meta property="og:site_name" content="Withz">
<meta property="og:description" content="…">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-03-18T13:24:04.000Z">
<meta property="article:modified_time" content="2024-06-07T02:52:59.336Z">
<meta property="article:author" content="Peng">
<meta property="article:tag" content="Unity 3D">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://withz.github.io/2020/03/18/%E6%B8%B8%E6%88%8F/Unity3d/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://withz.github.io/2020/03/18/%E6%B8%B8%E6%88%8F/Unity3d/","path":"2020/03/18/游戏/Unity3d/","title":"Unity 3D"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Unity 3D | Withz</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Withz</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">64</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">11</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">51</span></a></li><li class="menu-item menu-item-tools"><a href="/tools/" rel="section"><i class="fa fa-flask fa-fw"></i>工具</a></li><li class="menu-item menu-item-sitemap"><a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%B8%B8%E6%88%8F"><span class="nav-number">1.</span> <span class="nav-text">开发游戏</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B8%E6%88%8F%E5%BC%95%E6%93%8E%E4%B8%8EAPI"><span class="nav-number">1.1.</span> <span class="nav-text">游戏引擎与API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%BA%E5%91%98%E5%88%86%E5%B7%A5"><span class="nav-number">1.2.</span> <span class="nav-text">人员分工</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Unity-%E6%93%8D%E4%BD%9C"><span class="nav-number">2.</span> <span class="nav-text">Unity 操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%95%8C%E9%9D%A2%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.1.</span> <span class="nav-text">界面介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9D%90%E6%A0%87%E7%B3%BB"><span class="nav-number">2.2.</span> <span class="nav-text">坐标系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF%E6%93%8D%E4%BD%9C"><span class="nav-number">2.3.</span> <span class="nav-text">场景操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Unity-%E8%B5%84%E6%BA%90"><span class="nav-number">3.</span> <span class="nav-text">Unity 资源</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95"><span class="nav-number">3.1.</span> <span class="nav-text">项目目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%90%E8%B4%A8-Material"><span class="nav-number">3.2.</span> <span class="nav-text">材质 Material</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9D%80%E8%89%B2%E5%99%A8"><span class="nav-number">3.3.</span> <span class="nav-text">着色器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%B9%E7%90%86%E8%B4%B4%E5%9B%BE"><span class="nav-number">3.4.</span> <span class="nav-text">纹理贴图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8B-FBS"><span class="nav-number">3.5.</span> <span class="nav-text">模型 FBS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A3%B0%E9%9F%B3"><span class="nav-number">3.6.</span> <span class="nav-text">声音</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%84%E8%AE%BE%E4%BD%93-Prefabs"><span class="nav-number">3.7.</span> <span class="nav-text">预设体 Prefabs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B8%E6%88%8F%E5%AF%B9%E8%B1%A1"><span class="nav-number">3.8.</span> <span class="nav-text">游戏对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9A%E4%BD%93%E7%A2%B0%E6%92%9E%E7%BB%84%E4%BB%B6"><span class="nav-number">3.9.</span> <span class="nav-text">刚体碰撞组件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%B0%E5%BD%A2"><span class="nav-number">3.10.</span> <span class="nav-text">地形</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%81%AF%E5%85%89"><span class="nav-number">3.11.</span> <span class="nav-text">灯光</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%91%84%E5%83%8F%E6%9C%BA"><span class="nav-number">3.12.</span> <span class="nav-text">摄像机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC"><span class="nav-number">3.13.</span> <span class="nav-text">脚本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%8F%E7%A8%8B"><span class="nav-number">3.14.</span> <span class="nav-text">协程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GUI"><span class="nav-number">3.15.</span> <span class="nav-text">GUI</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HUD"><span class="nav-number">3.16.</span> <span class="nav-text">HUD</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%B9%E6%95%88"><span class="nav-number">3.17.</span> <span class="nav-text">特效</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%92%E8%89%B2"><span class="nav-number">3.18.</span> <span class="nav-text">角色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E7%94%BB"><span class="nav-number">3.19.</span> <span class="nav-text">动画</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%84%E7%BA%BF%E7%A2%B0%E6%92%9E"><span class="nav-number">3.20.</span> <span class="nav-text">射线碰撞</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E5%8C%85"><span class="nav-number">3.21.</span> <span class="nav-text">资源包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Asset-Store"><span class="nav-number">3.22.</span> <span class="nav-text">Asset Store</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AB%98%E9%80%9A-AR"><span class="nav-number">3.23.</span> <span class="nav-text">高通 AR</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#C-Sharp"><span class="nav-number">4.</span> <span class="nav-text">C Sharp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mono%E8%84%9A%E6%9C%AC%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="nav-number">5.</span> <span class="nav-text">Mono脚本的生命周期</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E5%99%A8"><span class="nav-number">5.1.</span> <span class="nav-text">编辑器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">5.2.</span> <span class="nav-text">初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%A9%E7%90%86%E5%BC%95%E6%93%8E"><span class="nav-number">5.3.</span> <span class="nav-text">物理引擎</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Input-%E4%BA%8B%E4%BB%B6"><span class="nav-number">5.4.</span> <span class="nav-text">Input 事件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B8%E6%88%8F%E9%80%BB%E8%BE%91"><span class="nav-number">5.5.</span> <span class="nav-text">游戏逻辑</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%BA%E6%99%AF%E6%B8%B2%E6%9F%93"><span class="nav-number">5.6.</span> <span class="nav-text">场景渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Gizmos-%E6%B8%B2%E6%9F%93"><span class="nav-number">5.7.</span> <span class="nav-text">Gizmos 渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GUI-%E6%B8%B2%E6%9F%93"><span class="nav-number">5.8.</span> <span class="nav-text">GUI 渲染</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%A7%E7%BB%93%E6%9D%9F"><span class="nav-number">5.9.</span> <span class="nav-text">帧结束</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9A%82%E5%81%9C"><span class="nav-number">5.10.</span> <span class="nav-text">暂停</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%97%AD"><span class="nav-number">5.11.</span> <span class="nav-text">关闭</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%80%E6%AF%81"><span class="nav-number">5.12.</span> <span class="nav-text">销毁</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">6.</span> <span class="nav-text">程序设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="nav-number">6.1.</span> <span class="nav-text">设计原则</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3"><span class="nav-number">6.1.1.</span> <span class="nav-text">单一职责</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99"><span class="nav-number">6.1.2.</span> <span class="nav-text">开闭原则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E5%8E%9F%E5%88%99"><span class="nav-number">6.1.3.</span> <span class="nav-text">依赖倒置原则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99"><span class="nav-number">6.1.4.</span> <span class="nav-text">接口隔离原则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%88%E6%88%90%E5%A4%8D%E7%94%A8%E5%8E%9F%E5%88%99"><span class="nav-number">6.1.5.</span> <span class="nav-text">合成复用原则</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%AA%E7%B1%B3%E7%89%B9%E6%B3%95%E5%88%99"><span class="nav-number">6.1.6.</span> <span class="nav-text">迪米特法则</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="nav-number">6.2.</span> <span class="nav-text">设计模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="nav-number">6.2.1.</span> <span class="nav-text">单例模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="nav-number">6.2.2.</span> <span class="nav-text">工厂模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="nav-number">6.2.3.</span> <span class="nav-text">观察者模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="nav-number">6.2.4.</span> <span class="nav-text">代理模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AD%96%E7%95%A5%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="nav-number">6.2.5.</span> <span class="nav-text">策略者模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="nav-number">6.2.6.</span> <span class="nav-text">建造者模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="nav-number">6.2.7.</span> <span class="nav-text">中介者模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="nav-number">6.2.8.</span> <span class="nav-text">外观模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="nav-number">6.2.9.</span> <span class="nav-text">组合模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="nav-number">6.2.10.</span> <span class="nav-text">状态者模式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Shader"><span class="nav-number">7.</span> <span class="nav-text">Shader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E8%AF%AD%E8%A8%80%E5%92%8C%E5%B7%A5%E5%85%B7"><span class="nav-number">7.1.</span> <span class="nav-text">开发语言和工具</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C"><span class="nav-number">8.</span> <span class="nav-text">网络</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="nav-number">8.1.</span> <span class="nav-text">基本介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%BF%9E%E6%8E%A5"><span class="nav-number">8.2.</span> <span class="nav-text">创建连接</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E6%A8%A1%E5%9D%97"><span class="nav-number">9.</span> <span class="nav-text">示例模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%9D%97"><span class="nav-number">9.1.</span> <span class="nav-text">网络传输模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9F%B3%E6%95%88%E6%A8%A1%E5%9D%97"><span class="nav-number">9.2.</span> <span class="nav-text">音效模块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%A0%E6%AD%A4%EF%BC%9A-%E5%BA%94%E8%AF%A5%E4%BD%BF%E7%94%A8%E6%9C%89%E9%99%90%E4%B8%AAAudio-Source%E6%92%AD%E6%94%BE%E6%89%80%E6%9C%89Clips%EF%BC%88%E5%AF%B9%E8%B1%A1%E6%B1%A0%EF%BC%89"><span class="nav-number">10.</span> <span class="nav-text">因此：- 应该使用有限个Audio Source播放所有Clips（对象池）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UI-%E6%A8%A1%E5%9D%97"><span class="nav-number">10.1.</span> <span class="nav-text">UI 模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%91%87%E6%9D%86-EasyTouch"><span class="nav-number">10.2.</span> <span class="nav-text">摇杆 EasyTouch</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E5%9C%B0%E5%9B%BE"><span class="nav-number">10.3.</span> <span class="nav-text">小地图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GL"><span class="nav-number">10.4.</span> <span class="nav-text">GL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E5%9C%B0%E5%9B%BE%E4%B8%8A%E7%9A%84%E6%91%84%E5%83%8F%E6%9C%BA%E5%8F%AF%E8%A7%86%E5%8C%BA%E5%9F%9F"><span class="nav-number">10.5.</span> <span class="nav-text">小地图上的摄像机可视区域</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Peng</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">64</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://withz.github.io/2020/03/18/%E6%B8%B8%E6%88%8F/Unity3d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Peng">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Withz">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Unity 3D | Withz">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Unity 3D
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-18 21:24:04" itemprop="dateCreated datePublished" datetime="2020-03-18T21:24:04+08:00">2020-03-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-06-07 10:52:59" itemprop="dateModified" datetime="2024-06-07T10:52:59+08:00">2024-06-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%B8%B8%E6%88%8F%E4%B8%8E3D/" itemprop="url" rel="index"><span itemprop="name">游戏与3D</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>…</p>
<span id="more"></span>

<h2 id="开发游戏"><a href="#开发游戏" class="headerlink" title="开发游戏"></a>开发游戏</h2><h3 id="游戏引擎与API"><a href="#游戏引擎与API" class="headerlink" title="游戏引擎与API"></a>游戏引擎与API</h3><p>常用游戏引擎有：Unity，UE4，Cocos，laya，白鹭等。<br>常用开发API有：DirectX，OpenGL，Vulkan等。</p>
<h3 id="人员分工"><a href="#人员分工" class="headerlink" title="人员分工"></a>人员分工</h3><p>程序：</p>
<ul>
<li>服务端</li>
<li>客户端<ul>
<li>UI 实现</li>
<li>业务逻辑</li>
<li>动画实现</li>
<li>计费SDK</li>
</ul>
</li>
<li>工具开发</li>
<li>运营数据系统</li>
</ul>
<p>美工：</p>
<ul>
<li>原画</li>
<li>3D建筑</li>
<li>3D角色</li>
<li>动画</li>
<li>特效</li>
<li>地形编辑</li>
<li>UI 界面</li>
<li>灯光</li>
<li>场景</li>
<li>TA：即懂美术也懂程序，写Shader的</li>
</ul>
<p>策划：</p>
<ul>
<li>系统策划</li>
<li>剧情策划</li>
<li>数值策划</li>
<li>关卡策划</li>
<li>任务策划</li>
<li>执行策划：盯着程序员的</li>
</ul>
<h2 id="Unity-操作"><a href="#Unity-操作" class="headerlink" title="Unity 操作"></a>Unity 操作</h2><h3 id="界面介绍"><a href="#界面介绍" class="headerlink" title="界面介绍"></a>界面介绍</h3><p>项目：由场景构成<br>场景 Sence：由游戏对象构成（看见的对象，光源，摄像机等）<br>游戏对象：由组件构成<br>组件：拥有多个属性</p>
<p>菜单栏：</p>
<ul>
<li>File：场景操作和项目操作。</li>
<li>Edit：复制粘贴等<ul>
<li>Duplicate：复制，包括Copy与Paste</li>
<li>Prefrence：首选项</li>
</ul>
</li>
<li>Assets：资源<ul>
<li>Create：创建</li>
<li>Import：导入资源包</li>
</ul>
</li>
<li>GameObject：游戏对象<ul>
<li>Create</li>
<li>2D Object</li>
<li>3D Object</li>
<li>Effects</li>
<li>Light</li>
<li>Audio</li>
<li>Video</li>
<li>UI</li>
<li>Camera</li>
</ul>
</li>
<li>Component：<ul>
<li>Mesh</li>
<li>Effects</li>
<li>Physics</li>
<li>Physics 2D</li>
<li>Navigation</li>
<li>Audio</li>
<li>Video</li>
<li>Rendering</li>
<li>Layout</li>
<li>Playables</li>
<li>AR</li>
<li>Miscellaneous</li>
<li>Analytics</li>
<li>UI</li>
<li>Scripts</li>
<li>Events</li>
</ul>
</li>
<li>Window：面板控制</li>
<li>Help<ul>
<li>Scripting Reference：手册</li>
</ul>
</li>
</ul>
<p>Layout：布局方式<br>Project：项目面板，管理所有文件<br>Scene：场景面板，列出场景中的所有对象<br>Game：游戏面板，玩家看到的面板，由摄像机拍摄<br>Hierarchy：层级，管理场景中的所有游戏对象<br>Inspector：显示游戏对象上的组件及组件属性<br>Layers：</p>
<ul>
<li>层，用于管理文件组。</li>
<li>系统保留8个层，共有32个层。</li>
</ul>
<h3 id="坐标系"><a href="#坐标系" class="headerlink" title="坐标系"></a>坐标系</h3><p>Untiy 使用左手系。</p>
<p>ISO：正交视图<br>Persp：透视视图</p>
<h3 id="场景操作"><a href="#场景操作" class="headerlink" title="场景操作"></a>场景操作</h3><p>鼠标操作：</p>
<ul>
<li>旋转：鼠标右键 &#x2F; Alt + 左键</li>
<li>缩放：Alt + 鼠标右键 &#x2F; 滚轮</li>
<li>平移：鼠标中键 &#x2F; 上方手</li>
<li>锁：禁止旋转</li>
<li>选中多个：Shift + 点选</li>
</ul>
<p>上方工具栏（快捷键）：</p>
<ul>
<li>平移场景 Q</li>
<li>移动物体 W</li>
<li>旋转物体 E</li>
<li>缩放物体 R</li>
<li>2D缩放物体 T</li>
<li>Center &#x2F; Pivot：坐标轴位置 Z</li>
<li>Global &#x2F; Local：切换坐标系 X</li>
</ul>
<p>快捷键：</p>
<ul>
<li>V：顶点捕捉</li>
<li>Ctrl + D：复制</li>
<li>Ctrl：角度捕捉</li>
</ul>
<h2 id="Unity-资源"><a href="#Unity-资源" class="headerlink" title="Unity 资源"></a>Unity 资源</h2><h3 id="项目目录"><a href="#项目目录" class="headerlink" title="项目目录"></a>项目目录</h3><p>Assets：管理资源文件</p>
<ul>
<li>Animations</li>
<li>Animators</li>
<li>Audio</li>
<li>Done</li>
<li>Fonts</li>
<li>Gizmos</li>
<li>Materials</li>
<li>Models</li>
<li>Prefabs</li>
<li>Scenes</li>
<li>Scripts</li>
<li>Shaders</li>
<li>Textures<br>特殊</li>
<li>Standard Assets：内置优先加载</li>
<li>Editor：扩展编辑器</li>
<li>Plugins：插件Dll</li>
<li>Resources：资源文件</li>
</ul>
<h3 id="材质-Material"><a href="#材质-Material" class="headerlink" title="材质 Material"></a>材质 Material</h3><p>可以配置颜色，图片。<br>可以添加着色器。</p>
<h3 id="着色器"><a href="#着色器" class="headerlink" title="着色器"></a>着色器</h3><p>Diffuse：Base贴图。<br>Bumped Diffuse：Base贴图和法线贴图。<br>Bumped Specular：再加入高光材质。</p>
<h3 id="纹理贴图"><a href="#纹理贴图" class="headerlink" title="纹理贴图"></a>纹理贴图</h3><p>尺寸需要被2整除（256*256）。</p>
<p>可以创建法线贴图。<br>Texture Type：贴图类型<br>MaxSize：纹理取样尺寸。</p>
<p>Substance Designer：一款材质制作工具。</p>
<p>GUI 纹理显示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">OnGUI</span>(<span class="params"></span>)&#123;&#125;  <span class="comment">// GUI 启动</span></span><br><span class="line"><span class="title class_">Resources</span>.<span class="title class_">Load</span>()    <span class="comment">// 加载Resources文件夹</span></span><br><span class="line"><span class="title class_">Resources</span>.<span class="title class_">LoadAll</span>()</span><br><span class="line"><span class="variable constant_">GUI</span>.<span class="title class_">DrawTexutre</span>()</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">private <span class="keyword">var</span> <span class="attr">oneTexture</span>:<span class="title class_">Texture2D</span>;</span><br><span class="line">private <span class="keyword">var</span> <span class="attr">allTexutre</span>:<span class="title class_">Object</span>[];</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">OnGUI</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable constant_">GUI</span>.<span class="title class_">Button</span>(<span class="title class_">Rect</span>(<span class="number">0</span>,<span class="number">20100</span>,<span class="number">60</span>), <span class="string">&quot;loadOne&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(oneTexutre == <span class="literal">null</span>)&#123;</span><br><span class="line">            oneTexture = <span class="title class_">Resources</span>.<span class="title class_">Load</span>(<span class="string">&quot;one/Grass&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable constant_">GUI</span>.<span class="title class_">Button</span>(<span class="title class_">Rect</span>(<span class="number">0</span>,<span class="number">20100</span>,<span class="number">60</span>), <span class="string">&quot;loadAll&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(allTexutre == <span class="literal">null</span>)&#123;</span><br><span class="line">            allTexutre = <span class="title class_">Resources</span>.<span class="title class_">Load</span>(<span class="string">&quot;all&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(allTexutre!=<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;allTexture.<span class="property">Length</span>;i++)&#123;</span><br><span class="line">            <span class="variable constant_">GUI</span>.<span class="title class_">DrawTexture</span>(<span class="title class_">Rect</span>(<span class="number">110</span>+i*<span class="number">120</span>,<span class="number">140</span>,<span class="number">120</span>,<span class="number">120</span>), allTexutre[i],<span class="title class_">ScaleMode</span>.<span class="property">StretchToFill</span>,<span class="literal">true</span>,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Moive纹理，是一个动画纹理。导入后转为OGG格式。</p>
<h3 id="模型-FBS"><a href="#模型-FBS" class="headerlink" title="模型 FBS"></a>模型 FBS</h3><p>模型一般有FBS，OBJ格式，一般使用FBS。<br>如果导出的是3DMAX等文件，可以用Blend，Untiy转换为FBX。</p>
<p>编辑时尽量让z轴朝向前方，以便以后程序控制。</p>
<p>对于动画，可以导出一个动画，再在Untiy中分割成多个动画；也可以导出为多个文件。但是多文件时命名要遵循<code>模型@动画</code>命名规则。</p>
<p>Model：</p>
<ul>
<li>Meshes：缩放因子 0.01，MeshCompression 网格压缩，ReadWriteEnable 运行时修改，OptimizeMesh 优化，GenerateColliders 碰撞（对固定物体较好），SwapUV，GenerateLightMapUV</li>
<li>Normals &amp; Tangents：法线切线（输入，计算），SplitTangents 分割法线</li>
<li>Materials：导入材质，材质命名，材质搜索<br>Rig：动画类型，人&#x2F;物。<br>Animations：动画如何分割。</li>
</ul>
<p>模型：</p>
<ul>
<li>组成部分</li>
<li>网格</li>
<li>动画</li>
</ul>
<p>控制模型：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Move</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span>&#123;</span><br><span class="line">        <span class="built_in">float</span> horizontal = Input.GetAxis(<span class="string">&quot;Horizontal&quot;</span>);</span><br><span class="line">        <span class="built_in">float</span> vertical = Input.GetAxis(<span class="string">&quot;Vertical&quot;</span>);</span><br><span class="line">        Vector3 direction = <span class="keyword">new</span> Vector3(horizontal, <span class="number">0</span>, vertical);</span><br><span class="line">        <span class="keyword">if</span>(direction!=Vector3.zero)&#123;</span><br><span class="line">            transform.GetComponent&lt;Animation&gt;().CrossFade(<span class="string">&quot;walk&quot;</span>);</span><br><span class="line">            transform.rotation = Quaternion.LookRotation(direction);</span><br><span class="line">            transform.Translate(Vector3.forward * <span class="number">1</span> * Time.deltaTime);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            transform.GetComponent&lt;Animation&gt;().CrossFade(<span class="string">&quot;idle&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnCollisionEnter</span>(<span class="params">Collision collision</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(collision.gameObject.name == <span class="string">&quot;Plane&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        transform.GetComponient&lt;Animation&gt;().CrossFade(<span class="string">&quot;bite&quot;</span>);</span><br><span class="line">        collision.transofrm.GetComponent&lt;Animation&gt;(<span class="string">&quot;die&quot;</span>);</span><br><span class="line">        Destroy(collision.gameObject, <span class="number">5f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="声音"><a href="#声音" class="headerlink" title="声音"></a>声音</h3><p>是否为3D声音：有距离感。<br>载入方式。</p>
<p>音源组件：发出声音的物体。<br>声音监听组件：听到声音的物体。</p>
<h3 id="预设体-Prefabs"><a href="#预设体-Prefabs" class="headerlink" title="预设体 Prefabs"></a>预设体 Prefabs</h3><p>用来批量管理游戏对象。<br>也可以批量添加预设物体。</p>
<p>可以将游戏对以文件形式存储起来：从层级面板拖入项目目录即可。</p>
<p>Select：快速找到该预设体。<br>Revert：还原为预设体中的设置。<br>Apply：将修改后的设置放入预设体。</p>
<h3 id="游戏对象"><a href="#游戏对象" class="headerlink" title="游戏对象"></a>游戏对象</h3><p>层级关系：<br>子物体的Transform是相对于父物体的</p>
<p>基本对象：<br>Cube<br>Sphere<br>Plane：由多个三角形构成<br>Quad：由2个三角形构成<br>Terrain：地形</p>
<p>Tag：属于某一个类。<br>Layer：属于某一个层。</p>
<p>搜索对象：在层级面板双击 &#x2F; 单击，在场景中按 F</p>
<p>对象组件：<br>Transform：位置 &#x2F; 旋转 &#x2F; 缩放<br>Mesh Filter：决定游戏对象的形状<br>Mesh Rendeer：决定游戏对象的外观展示</p>
<ul>
<li>Material：材质</li>
</ul>
<h3 id="刚体碰撞组件"><a href="#刚体碰撞组件" class="headerlink" title="刚体碰撞组件"></a>刚体碰撞组件</h3><p>Rigidbody：刚体组件，模拟物理效果</p>
<ul>
<li>Mass：质量</li>
<li>Drag：拉力，阻力</li>
<li>Angular Drag：旋转拉力</li>
<li>Use Gravity：重力</li>
<li>Is Kinematic：开启运动学，不受力</li>
<li>Interpolate：插值</li>
<li>Collision Detection：碰撞检测</li>
<li>Constraints：约束<br>Collider：碰撞体组件</li>
<li>用于碰撞检测</li>
<li>可以编辑碰撞体</li>
<li>is trigger</li>
<li>material：物理材质<ul>
<li>dynamic friction：动态摩擦力</li>
<li>static friction：静态摩擦力</li>
<li>bounciness：弹力</li>
<li>friction combine：组合摩擦力</li>
<li>bounce combine：组合弹力</li>
</ul>
</li>
<li>center</li>
<li>size</li>
</ul>
<h3 id="地形"><a href="#地形" class="headerlink" title="地形"></a>地形</h3><p>一种游戏对象。</p>
<p>Terrain：地形</p>
<ul>
<li>Terrain：地形修改器<ul>
<li>Brush：<ul>
<li>Brush Size：大小</li>
<li>Opacity：硬度</li>
</ul>
</li>
<li>地形<ul>
<li>抬高</li>
<li>恒高</li>
</ul>
</li>
<li>地形纹理<ul>
<li>可添加多个纹理，作为笔刷</li>
</ul>
</li>
<li>种树种草</li>
<li>放水</li>
</ul>
</li>
</ul>
<h3 id="灯光"><a href="#灯光" class="headerlink" title="灯光"></a>灯光</h3><p>灯光可以是游戏对象，也可以是组件。</p>
<p>灯光类型：</p>
<ul>
<li>Directional Light：影响所有物体</li>
<li>Point</li>
<li>Spot</li>
<li>Area</li>
</ul>
<p>项目设置-&gt;Player，可以在不同平台上设置渲染路径。<br>Vertex List<br>Forward<br>Deferred Lighting</p>
<p>灯光类型：点，聚光灯Spot，方向灯，区域灯光。<br>阴影类型。<br>灯光耀斑：Draw Halo<br>渲染重要性：Render Mode</p>
<h3 id="摄像机"><a href="#摄像机" class="headerlink" title="摄像机"></a>摄像机</h3><p>ClearFlag：天空盒，实体色，深度信息（多摄像机叠加）等。<br>投影方式。<br>前后截面。<br>视口尺寸。<br>深度：深度大的会叠加到深度小的摄像机上。</p>
<h3 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h3><p>GameObject包含的组件</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">tranform <span class="comment">// 位移</span></span><br><span class="line">rigibody <span class="comment">// 刚体</span></span><br><span class="line">camera</span><br><span class="line">light</span><br><span class="line">render</span><br><span class="line">animation</span><br><span class="line">audio</span><br><span class="line">其他</span><br><span class="line"><span class="comment">// 或写为</span></span><br><span class="line"><span class="keyword">this</span>.gameObject.transform</span><br><span class="line"><span class="comment">// 其他组件 </span></span><br><span class="line">other.GetComponent(<span class="string">&quot;filename&quot;</span>)</span><br><span class="line">other.GetComponent(filename)</span><br><span class="line">other.GetComponent&lt;filename&gt;()</span><br><span class="line"><span class="comment">// 搜索</span></span><br><span class="line">GameObject.FindGameObjectWithTag(<span class="string">&quot;tag&quot;</span>)</span><br><span class="line"><span class="comment">// 消息传递</span></span><br><span class="line">gameObject.SendMessageUpwards(<span class="string">&quot;ApplyDamage&quot;</span>, <span class="number">5.0</span>);</span><br></pre></td></tr></table></figure>

<p>Time对象，记录各种间隔时间。</p>
<h3 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line">    <span class="comment">// 启动一个协程，异步调用</span></span><br><span class="line">    StartCoroutine(Routine());</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">IEnumerator <span class="title">Routine</span>()</span>&#123;</span><br><span class="line">    <span class="comment">// 等待协程操作</span></span><br><span class="line">    <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">1f</span></span>)</span>;</span><br><span class="line">    <span class="comment">// 执行剩余任务</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="GUI"><a href="#GUI" class="headerlink" title="GUI"></a>GUI</h3><p>所有GUI相关都在OnGUI中实现。<br>常用控件：</p>
<ul>
<li>Label</li>
<li>Button：点击后，返回True</li>
<li>RepeatButton：按下后持续执行。</li>
<li>TextField：返回string</li>
<li>Toggle：开关</li>
<li>HorizontalSlider：滑块<br>复合控件：</li>
<li>Toolbar</li>
<li>SelectionGrid</li>
</ul>
<p>GUI.changed：GUI更新<br>GUI.skin：GUI风格</p>
<p>定义组：</p>
<ul>
<li>GUI.BeginGroup()</li>
<li>GUI.EndGroup()</li>
</ul>
<p>GUILayout.Button<br>GUILayout.Box</p>
<h3 id="HUD"><a href="#HUD" class="headerlink" title="HUD"></a>HUD</h3><p>角色屏幕上固定的界面。</p>
<p>Add Component，GUITexture，然后调整位置大小。</p>
<h3 id="特效"><a href="#特效" class="headerlink" title="特效"></a>特效</h3><p>使用粒子系统添加特效。<br>OpenEditor：打开独立编辑器。<br><code>+</code>-&gt;Show All Modules：显示所有特效<br>基本参数：</p>
<ul>
<li>Duration：粒子持续时间</li>
<li>Loging：循环</li>
<li>Prewarm：预热，一般不需要</li>
<li>Start XXX：启动设置，可以设置曲线（随机数范围）</li>
<li>Gravity Multiplier：重力</li>
<li>Inherit Velocity：继承速度，没用</li>
<li>Simulation Space：本地坐标，世界坐标，粒子是否随着发射器移动</li>
<li>Play On Awake：是否初始激活</li>
<li>Max Particles：最大粒子数<br>Emission：</li>
<li>Rate：发射速率 &#x2F; 距离</li>
<li>Bursts：爆炸<br>Shape：</li>
<li>Shape：形状</li>
<li>Angle：角度</li>
<li>Radius：半径</li>
<li>Length：长度</li>
<li>EmitFromShell：发射面</li>
<li>Random Direction：随机方向<br>XXX Over LifeTime：速度，限制速度，力，颜色，大小，旋转</li>
<li>XYZ：速度方向</li>
<li>Space：坐标</li>
<li>Dampen：阻尼</li>
<li>Separate Axis：锁定轴<br>XXX By Speed：颜色，大小，旋转<br>External Forces：力学，不用<br>Collision：碰撞，消耗资源</li>
<li>Planes：碰撞面板</li>
<li>Scale Plane</li>
<li>Dampen：阻尼</li>
<li>Bounce：摩擦</li>
<li>Lifetime Less：减少的寿命</li>
<li>Min Kill Speed</li>
<li>Particle Radius：碰撞位置偏移</li>
<li>Send Collision Message：发送碰撞信息<br>Sub Emitters：下一个粒子系统</li>
<li>Birth</li>
<li>Collision</li>
<li>Death<br>Texture Sheet Animation：贴图UV动画</li>
<li>Tiles</li>
<li>Animation</li>
<li>Frame Over TIme</li>
<li>Cycles<br>Render</li>
<li>Render Mode：板，拉伸，平行，垂直，模型</li>
<li>Normal Direction</li>
<li>Material：材质</li>
<li>Sort Mode</li>
<li>Sorting Fudge：优先渲染</li>
<li>Case Shadows</li>
<li>Receive Shadows</li>
<li>Max Particles Size：最大大小</li>
</ul>
<h3 id="角色"><a href="#角色" class="headerlink" title="角色"></a>角色</h3><p>CharacterController：角色控制器<br>CharacterMotor：角色引擎</p>
<h3 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h3><p>Mecanim</p>
<h3 id="射线碰撞"><a href="#射线碰撞" class="headerlink" title="射线碰撞"></a>射线碰撞</h3><p>Raycast</p>
<h3 id="资源包"><a href="#资源包" class="headerlink" title="资源包"></a>资源包</h3><p>导出：在项目目录 Export Package</p>
<p>导入：在项目目录 Import Package</p>
<ul>
<li>自定义资源包</li>
<li>内置资源包（Standard Asserts）</li>
</ul>
<h3 id="Asset-Store"><a href="#Asset-Store" class="headerlink" title="Asset Store"></a>Asset Store</h3><p>在线资源库。</p>
<h3 id="高通-AR"><a href="#高通-AR" class="headerlink" title="高通 AR"></a>高通 AR</h3><p>首先在<a target="_blank" rel="noopener" href="https://developer.vuforia.com/">高通AR</a>上下载资SDK（需要注册）。</p>
<p>将下载的SDK资源包导入到Unity中。如果中途提示升级，不需要升级。</p>
<p>配置License Key，要到官网申请License Key，并将其配置到项目中。</p>
<p>在Develop -&gt; License Manager中申请（Development）。</p>
<p>点击创建的项目，进入项目详情，可以看到License Key。复制Key，进入项目目录，在Resources-&gt;VuforiaConfiguration中加入Key。</p>
<p>之后上传图片：将要扫描的图片上传到高通，进入Target Manager -&gt; Database，创建数据库，Device，然后进入数据库，Add Target，Single Image，上传图片。</p>
<p>之后下载数据库并导入项目，Download Database，Unity，将下载的数据库导入到项目。</p>
<p>在项目中，首先删掉 Main Camera，并导入AR Camera。Vuforia Prefabs AR Camera，和 Image Target。</p>
<p>再配置Image Target，在其插件中配置Database，Image Target，高和宽，</p>
<p>再配置 VuforiaConfiguration，Datasets，Load并Active。</p>
<p>放置要出现的虚拟物体，作为Image Target的子物体。</p>
<h2 id="C-Sharp"><a href="#C-Sharp" class="headerlink" title="C Sharp"></a>C Sharp</h2><p>字符串是引用类型。字符串操作：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> str = <span class="string">$&quot;this is <span class="subst">&#123;box&#125;</span>&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> str = <span class="string">@&quot;C:\Program files\&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>控制台输入输出</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> str = Console.ReadLine(<span class="string">&quot;&#123;0&#125;&quot;</span>, box);</span><br><span class="line">Console.WriteLine(<span class="string">&quot;&#123;0&#125;&quot;</span>, box);</span><br><span class="line">Console.ReadKey();</span><br></pre></td></tr></table></figure>

<p>遍历数组</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 无法修改元素</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="built_in">int</span> x <span class="keyword">in</span> array) &#123; &#125;</span><br></pre></td></tr></table></figure>

<p>param关键字：用来修饰形参</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用</span></span><br><span class="line">method(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line"><span class="comment">// 定义</span></span><br><span class="line">method(param <span class="built_in">int</span>[] array) &#123; &#125;</span><br></pre></td></tr></table></figure>

<p>引用，ref可以不赋值，但是out必须赋值，且out默认没有值，不可以直接使用。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 传入引用</span></span><br><span class="line">method(<span class="keyword">ref</span> a);</span><br><span class="line">method(<span class="keyword">ref</span> <span class="built_in">int</span> a) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 传入引用</span></span><br><span class="line">method(<span class="keyword">out</span> a);</span><br><span class="line">method(<span class="keyword">out</span> <span class="built_in">int</span> a) &#123; &#125;</span><br></pre></td></tr></table></figure>

<p>类继承后，重写父类方法，可以用new；虚函数virtual可以重写override。</p>
<p>类和结构体的区别是，类在堆上，结构体在栈上（值类型）。<br>结构体必须是有参构造方法，并要给所有字段赋值。</p>
<p>类的默认类型是internal，在项目内部可见。</p>
<p>Sealed：密封，不允许继承，可以用于修饰类和方法。</p>
<p>命名空间中只有类，结构体，枚举，接口。</p>
<p>运算符重载</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Point <span class="keyword">operator</span> +(Point p1, Point p2) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>抽象类abstract类</p>
<p>接口Interface：一系列的规范，接口实现必须是public</p>
<p>委托可以直接赋值</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TestDelegate oneDelegate = TestMethod;</span><br></pre></td></tr></table></figure>

<p>匿名函数</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TestDelegateX method = <span class="built_in">delegate</span>()&#123;&#125;;</span><br><span class="line">TestDelegateX method = () =&gt; &#123;&#125;; <span class="comment">// 参数 =&gt; 方法体</span></span><br></pre></td></tr></table></figure>

<p>用委托可以实现回调。</p>
<p>泛型，泛型不可继承</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Person</span>&lt;<span class="title">T</span>&gt; &#123; &#125;</span><br></pre></td></tr></table></figure>

<p>集合：是容器，变长的，类型可不同。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ArrayList list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">list.Add(<span class="number">1</span>);</span><br><span class="line">list.Add(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">list.AddRange(<span class="keyword">new</span> ICollection()); <span class="comment">//ICollection可以是集合，数组等</span></span><br><span class="line">list.Remove(); <span class="comment">// 删掉第一个匹配项</span></span><br><span class="line">list.RemoveAt(); <span class="comment">// 删除某个</span></span><br><span class="line">list.RemoveRange();  <span class="comment">// 批量删除，下标与长度</span></span><br><span class="line">list.SetRange(<span class="number">0</span>, <span class="keyword">new</span> <span class="built_in">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;);</span><br><span class="line">list.IndexOf();</span><br><span class="line">list.LastIndexOf();</span><br><span class="line">list.BinarySearch(); <span class="comment">// 二分查找</span></span><br><span class="line">list.Sort();</span><br><span class="line">list.Reverse();</span><br><span class="line">list.Contains();</span><br><span class="line">list.Insert(<span class="number">0</span>, <span class="string">&quot;a&quot;</span>);</span><br><span class="line">list.InsertRange(<span class="number">0</span>, <span class="built_in">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>&#125;);</span><br></pre></td></tr></table></figure>

<p>实现ICompareable可以实现排序。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CompareTo &lt;<span class="number">0</span> <span class="keyword">this</span>&lt;obj</span><br></pre></td></tr></table></figure>

<p>List：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">list.RemoveAll(Predicate&lt;<span class="keyword">in</span> T&gt;(T obj)); <span class="comment">// 删除匹配项</span></span><br><span class="line">list.RemoveAll(name =&gt; name==<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">Exists(name =&gt; name==<span class="string">&quot;abc&quot;</span>)   <span class="comment">// 判断存在</span></span><br><span class="line">FindXXX(name =&gt; name==<span class="string">&quot;abc&quot;</span>)</span><br><span class="line">GetRange() <span class="comment">// 获取子集</span></span><br></pre></td></tr></table></figure>

<p>其他类型：<br>Stack<br>Queue<br>Hashtable：键值对，内部按照Key的Hash排序<br>Dictionary：字典，必须指定类型</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Hashtable table = <span class="keyword">new</span> Hashtable();</span><br><span class="line">table.Add(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(DictionaryEntry entry <span class="keyword">in</span> table)&#123;</span><br><span class="line">    entry.Key;</span><br><span class="line">    entry.Value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; dic = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;();</span><br><span class="line">dic.Add(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span>(KeyValuePair&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; pair <span class="keyword">in</span> dic)&#123;</span><br><span class="line">    pair.Key;</span><br><span class="line">    pair.Value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正则表达式：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Text.RegularExpressions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test</span>()</span>&#123;</span><br><span class="line">        <span class="built_in">bool</span> result = Regex.IsMatch(<span class="string">&quot;a string&quot;</span>, <span class="string">&quot;^[1-9]\\d&#123;4,10&#125;$&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>^</code>: 字符串开头<br><code>$</code>: 字符串结尾<br><code>[]</code>: 匹配括号中的一位字符<br><code>[^]</code>: 匹配括号以外的一位字符<br><code>+</code>: 匹配1次或多次<br><code>*</code>: 匹配0次或多次<br><code>?</code>: 匹配0次或1次<br><code>&#123;m&#125;</code>: 恰好出现m次<br><code>&#123;m,&#125;</code>: 至少出现m次<br><code>&#123;m,n&#125;</code>: 出现m到n次<br><code>\d</code>: <code>[0-9]</code><br><code>.</code>: 匹配任意字符<br><code>()</code>: 分组，返回Match，多个分组</p>
<p>异常处理：如果Catch异常有继承关系，父类应放到最后。</p>
<p>反射：可以通过类名，字段来实例化对象，操作类成员。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 已有的定义</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">Type</span>&#123;</span><br><span class="line">    FieldInfo,</span><br><span class="line">    MethodInfo,</span><br><span class="line">    Constructor,</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 实例化对象</span></span><br><span class="line">Type t = Type.GetType(<span class="string">&quot;Space.Person&quot;</span>); <span class="comment">// 通过类名获取类型  </span></span><br><span class="line"><span class="built_in">object</span> obj = Activator.CreateInstance(t); <span class="comment">// 只能是 public 构造方法</span></span><br><span class="line"><span class="built_in">object</span> obj = Activator.CreateInstance(t, <span class="literal">true</span>); <span class="comment">// private, internal 也可以</span></span><br><span class="line"><span class="built_in">object</span> obj = Activator.CreateInstance(t, para1, para2); <span class="comment">// 有参构造</span></span><br><span class="line"><span class="built_in">object</span> obj = Activator.CreateInstance(t, BindingFlags.NonPublic|BindingFlags.Instance, <span class="literal">null</span>, <span class="keyword">new</span> <span class="built_in">object</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>&#125;, <span class="literal">null</span>); <span class="comment">// 有参其他权限构造</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问属性</span></span><br><span class="line">FileInfo name = t.GetField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">FileInfo name = t.GetField(<span class="string">&quot;name&quot;</span>, BindingFlags.NonPublic|BindingFlags.Instance);</span><br><span class="line">name.SetValue(obj, <span class="string">&quot;abc&quot;</span>); <span class="comment">// 静态成员，则用null</span></span><br><span class="line"><span class="built_in">object</span> x = name.GetValue(obj);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问方法</span></span><br><span class="line">MethodInfo method = t.GetMethod(<span class="string">&quot;Show&quot;</span>, BindingFlags.NonPublic|BindingFlags.Instance);</span><br><span class="line">method.Infoke(<span class="literal">null</span>, <span class="literal">null</span>); <span class="comment">// 第一个是谁在调用，第二个是调用的参数列表</span></span><br><span class="line"></span><br><span class="line">MethodInfo method = t.GetMethod(<span class="string">&quot;Show&quot;</span>, BindingFlags.NonPublic|BindingFlags.Instance, <span class="literal">null</span>, <span class="keyword">new</span> Type[]&#123;<span class="keyword">typeof</span>(<span class="built_in">string</span>), <span class="keyword">typeof</span>(<span class="built_in">double</span>)&#125;, <span class="literal">null</span>); <span class="comment">// 有重载的方法，Type中为参数类型列表</span></span><br><span class="line"><span class="built_in">object</span> result = method.Infoke(obj, <span class="keyword">new</span> <span class="built_in">object</span>[]&#123;<span class="string">&quot;1&quot;</span>, <span class="number">2.0</span>&#125;); <span class="comment">// 第一个是谁在调用，第二个是调用的参数列表</span></span><br></pre></td></tr></table></figure>




<h2 id="Mono脚本的生命周期"><a href="#Mono脚本的生命周期" class="headerlink" title="Mono脚本的生命周期"></a>Mono脚本的生命周期</h2><h3 id="编辑器"><a href="#编辑器" class="headerlink" title="编辑器"></a>编辑器</h3><p>Reset：当脚本被附加或重置时执行。</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>Awake：初始化后的第一步操作，整个声明周期只执行一次。<br>OnEnable：启动后的操作，可以多次执行。<br>Start：当第一帧启动前执行一次。</p>
<h3 id="物理引擎"><a href="#物理引擎" class="headerlink" title="物理引擎"></a>物理引擎</h3><p>从物理引擎开始，每一帧都要执行。<br>物理引擎部分一帧可能执行多次。<br>物理引擎是个非常消耗资源的部分。</p>
<p>FixedUpdate：按固定时间间隔执行。<br>yield WaitForFixedUpdate<br>OnTriggerXXX<br>OnCollisionXXX</p>
<h3 id="Input-事件"><a href="#Input-事件" class="headerlink" title="Input 事件"></a>Input 事件</h3><p>OnMouseXXX：响应设备事件。</p>
<h3 id="游戏逻辑"><a href="#游戏逻辑" class="headerlink" title="游戏逻辑"></a>游戏逻辑</h3><p>Update<br>yield null<br>yield WWW<br>yield WaitForSeconds<br>yield StartCoroutine<br>内部动画更新。<br>LateUpdate</p>
<h3 id="场景渲染"><a href="#场景渲染" class="headerlink" title="场景渲染"></a>场景渲染</h3><p>OnWillRenderObject：渲染前<br>OnPreCull<br>OnBecameVisible<br>OnBecamingVisible<br>OnPreRender<br>OnRenderObject<br>OnPostRender<br>OnRenderImage</p>
<h3 id="Gizmos-渲染"><a href="#Gizmos-渲染" class="headerlink" title="Gizmos 渲染"></a>Gizmos 渲染</h3><p>OnDrawGizmos</p>
<h3 id="GUI-渲染"><a href="#GUI-渲染" class="headerlink" title="GUI 渲染"></a>GUI 渲染</h3><p>OnGUI：可循环多次，但不建议使用</p>
<h3 id="帧结束"><a href="#帧结束" class="headerlink" title="帧结束"></a>帧结束</h3><p>yield WaitForEndOfFrame</p>
<h3 id="暂停"><a href="#暂停" class="headerlink" title="暂停"></a>暂停</h3><p>OnApplicationPause</p>
<h3 id="关闭"><a href="#关闭" class="headerlink" title="关闭"></a>关闭</h3><p>OnDisable</p>
<h3 id="销毁"><a href="#销毁" class="headerlink" title="销毁"></a>销毁</h3><p>OnApplicationQuit<br>OnDelete<br>OnDestory</p>
<h2 id="程序设计"><a href="#程序设计" class="headerlink" title="程序设计"></a>程序设计</h2><h3 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h3><h4 id="单一职责"><a href="#单一职责" class="headerlink" title="单一职责"></a>单一职责</h4><p>对象的职能只有一个。</p>
<h4 id="开闭原则"><a href="#开闭原则" class="headerlink" title="开闭原则"></a>开闭原则</h4><p>对象应该对于扩展是开放的，但是对于修改是封闭的。</p>
<h4 id="依赖倒置原则"><a href="#依赖倒置原则" class="headerlink" title="依赖倒置原则"></a>依赖倒置原则</h4><p>首先了解需求，画图表示；写出代码。</p>
<h4 id="接口隔离原则"><a href="#接口隔离原则" class="headerlink" title="接口隔离原则"></a>接口隔离原则</h4><p>接口里面的单一原则，也就是接口只负责一个功能。</p>
<h4 id="合成复用原则"><a href="#合成复用原则" class="headerlink" title="合成复用原则"></a>合成复用原则</h4><p>父类解决共有问题，子类解决特有问题。</p>
<p>是什么的问题改为有什么的问题。</p>
<p>能用现有的类，就不要创建新类。</p>
<h4 id="迪米特法则"><a href="#迪米特法则" class="headerlink" title="迪米特法则"></a>迪米特法则</h4><p>最少知识原则：尽量不牵扯到其他的类</p>
<h3 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h3><h4 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h4><p>整个软件的声明周期，有且只有一个实例。</p>
<p>拖拽一次，实例化一次。</p>
<p>用在组织框架管理者身上：WWW管理器，UI管理器，音效管理器。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只能拖拽挂载，不能 new</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Single</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Single instance;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>()</span>&#123;</span><br><span class="line">        instance = <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 另外一种方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Single</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Single instance;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Single Instance&#123;</span><br><span class="line">        <span class="keyword">get</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(instance == <span class="literal">null</span>)&#123;</span><br><span class="line">                instance = <span class="keyword">new</span> Single;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h4><p>交给它任务，它自动生产，最后返回一个产品。</p>
<p>不关心生产过程，用于创建新的对象。</p>
<p>例如生产金币，怪物。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Factory</span>&#123;</span><br><span class="line">    Sprite[] allSprite；</span><br><span class="line">    Transform parents;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Factory</span>()</span>&#123;</span><br><span class="line">        Initial();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Initial</span>()</span>&#123;</span><br><span class="line">        allSprite = Resources.LoadAll&lt;Sprite&gt;(<span class="string">&quot;res&quot;</span>);</span><br><span class="line">        <span class="comment">// 场景中唯一的物体，才做标记，灯光，摄像机</span></span><br><span class="line">        parents = GameObject.FindGameObjectWithTag(<span class="string">&quot;MainCanvas&quot;</span>).transform; <span class="comment">// 深度优先遍历，效率低</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> GameObject <span class="title">CreateImage</span>(<span class="params"><span class="built_in">int</span> index, Vector3 pos</span>)</span>&#123;</span><br><span class="line">        GameObject obj = <span class="keyword">new</span> GameObject();</span><br><span class="line">        obj.name = index.ToString();</span><br><span class="line">        <span class="comment">// 设置物体 Parents</span></span><br><span class="line">        obj.transform.SetParent(parents, <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 设置在 Parents 下的位置</span></span><br><span class="line">        obj.transform.SetAsSiblingIndex(<span class="number">2</span>);</span><br><span class="line">        obj.transform.SetAsLastSibling();</span><br><span class="line">        obj.transform.SetAsFirstSibling();</span><br><span class="line">        obj.transform.localPosition = pos;</span><br><span class="line"></span><br><span class="line">        Image img = obj.AddComponent&lt;Image&gt;();</span><br><span class="line">        index = index % allSprite.Length;</span><br><span class="line">        img.sprite = allSprite[index];</span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UseFactory</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    Factory factory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line">        factory = <span class="keyword">new</span> Factory();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span>&#123;</span><br><span class="line">        <span class="built_in">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(Input.GetKeyDown(KeyCode.Space))&#123;</span><br><span class="line">            facotry.CreateImage(++cnt, Vector3.one * cnt * <span class="number">50</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h4><p>不断地询问。</p>
<p>例如：播放一个动作，在1s的时候播放音效。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Obstor</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    Animation animal;</span><br><span class="line">    <span class="built_in">float</span> timeCount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line">        animal = GetComponent&lt;Animation&gt;();</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlayAction</span>()</span>&#123;</span><br><span class="line">        animal.Play(<span class="string">&quot;Action&quot;</span>);</span><br><span class="line">        timeCount = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 尽量轻量级</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!animal.isPlaying)&#123;</span><br><span class="line">            <span class="comment">// 判断动画是否完成</span></span><br><span class="line">        &#125;</span><br><span class="line">        timeCount += Time.deltaTime;</span><br><span class="line">        <span class="keyword">if</span>(timeCount &gt; <span class="number">1.0f</span>)&#123;</span><br><span class="line">            timeCount = <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// 判断是否到某个时间节点</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h4><p>使用回调（代理）的方式调用对方。B留出回调指针，M给B的回调指针加上A的方法。当触发到某一事件时，B调用回调函数，就会间接调用A。</p>
<p>例如：按钮事件。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.Events;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UseFactory</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    Factory factory;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line">        factory = <span class="keyword">new</span> Factory();</span><br><span class="line">        Button = btn = transform.GetComponent&lt;Button&gt;();</span><br><span class="line">        <span class="comment">// 传入回调函数</span></span><br><span class="line">        <span class="comment">// 分配的空间在堆上</span></span><br><span class="line">        btn.onClick.AddListener(<span class="keyword">new</span> UnityAciton(BtnOnClick));</span><br><span class="line">        <span class="comment">// 分配的空间在栈上</span></span><br><span class="line">        btn.onClick.AddListener(BtnOnClick);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">BtnOnClick</span>()</span>&#123;</span><br><span class="line">        <span class="comment">// 按钮事件</span></span><br><span class="line">        Debug.Log(<span class="string">&quot;Btn Clicked&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Master</span>&#123;</span><br><span class="line">    Worker worker;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CallWorker</span>()</span>&#123;</span><br><span class="line">        worker.Task();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnWorkerCall</span>()</span>&#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;Work Finish&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Worker</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> delete <span class="keyword">void</span> <span class="title">TaskPointer</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> TaskPointer taskPointer;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Task</span>()</span>&#123;</span><br><span class="line">        taskPointer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UseDelegate</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line">        Master master = <span class="keyword">new</span> Master();</span><br><span class="line">        Worker worker = <span class="keyword">new</span> Worker();</span><br><span class="line">        <span class="comment">// Master 调用 Worker</span></span><br><span class="line">        master.CallWorker();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Worker 调用 Master</span></span><br><span class="line">        worker.taskPointer += master.OnWorkerCall;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="策略者模式"><a href="#策略者模式" class="headerlink" title="策略者模式"></a>策略者模式</h4><p>决策制可以根据不同对象的输入得到不同的结果。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AbsBase</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> flaot pay;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">CalculateTex</span>()</span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AbsPerson</span>: <span class="title">AbsBase</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">CalculateTex</span>()</span>&#123;</span><br><span class="line">        <span class="keyword">base</span>.CalculateTex();</span><br><span class="line">        pay *= <span class="number">0.08f</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AbsCompany</span>: <span class="title">AbsBase</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> overrie <span class="keyword">void</span> <span class="title">CalculateTex</span>()</span>&#123;</span><br><span class="line">        <span class="keyword">base</span>.CalculateTex();</span><br><span class="line">        pay *= <span class="number">0.12f</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> TestAbstrator: MonoBehaviour&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CalculateTex</span>(<span class="params">AbsBase bs</span>)</span>&#123;</span><br><span class="line">        bs.CalculateTex();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据不同的对象，自动选择不同的计算方法，得到不同的结果</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line">        AbsPerson person = <span class="keyword">new</span> AbsPerson();</span><br><span class="line">        CalculateTex(person);</span><br><span class="line"></span><br><span class="line">        AbsCompany company = <span class="keyword">new</span> AbsCompany();</span><br><span class="line">        CalculateTex(company);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="建造者模式"><a href="#建造者模式" class="headerlink" title="建造者模式"></a>建造者模式</h4><p>将一个大的东西拆分成小的东西。</p>
<p>例如：MVC框架。</p>
<p>由顶部的UI Manager管理下层的对象。对模块的管理，用单例模式。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 不对外提供Manager，Worker，只提供Master</span></span><br><span class="line"><span class="comment">// Master是单例模式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Master</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Master instance;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Master Instance&#123;</span><br><span class="line">        <span class="keyword">get</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(instance == <span class="literal">null</span>)&#123;</span><br><span class="line">                instance = <span class="keyword">new</span> Master();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateTask</span>()</span>&#123;</span><br><span class="line">        Manager manager = <span class="keyword">new</span> Manager();</span><br><span class="line">        manager.ResolveTask();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Manager</span>()</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ResolveTask</span>()</span>&#123;</span><br><span class="line">        Worker worker = <span class="keyword">new</span> Worker();</span><br><span class="line">        worker.ExecuteTask();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Worker</span>()</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ExecuteTask</span>()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h4><p>防止类直接互相影响。解决耦合性问题。</p>
<p>例如：怪物和玩家之间的互相攻击。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MiddleBase</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> hp;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">reduce</span>(<span class="params"><span class="built_in">float</span> bias</span>)</span>&#123;</span><br><span class="line">        hp -= bias;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MiddleFirst</span>: <span class="title">MiddleBase</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">reduce</span>(<span class="params"><span class="built_in">float</span> bias</span>)</span>&#123;</span><br><span class="line">        hp -= bias * <span class="number">1.3f</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MiddleSecond</span>: <span class="title">MiddleBase</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">reduce</span>(<span class="params"><span class="built_in">float</span> bias</span>)</span>&#123;</span><br><span class="line">            hp -= bias * <span class="number">0.7f</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Main</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CalculateHP</span>(<span class="params">MiddleBase first, MiddleBase second</span>)</span>&#123;</span><br><span class="line">        first.reduce(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>()</span>&#123;</span><br><span class="line">        MiddleFirst first = <span class="keyword">new</span> MiddleFirst();</span><br><span class="line">        MiddleSecond second = <span class="keyword">new</span> MiddleSecond();</span><br><span class="line"></span><br><span class="line">        CalculateHP(first, second);</span><br><span class="line">        CalculateHP(second, first);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h4><p>将各种不同类型的东西放在一起，聚合，形成特定的功能。</p>
<p>例如：红绿灯，日期时间控件。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UI</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> GameObject Red;</span><br><span class="line">    <span class="keyword">private</span> GameObject Blue;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> stateRed = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line">        Button btn = GetComponent&lt;Button&gt;();</span><br><span class="line">        btn.onClick.AddListener(OnClick);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnClick</span>()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(stateRed)&#123;</span><br><span class="line">            Red.SetActive(<span class="literal">true</span>);</span><br><span class="line">            Blue.SetActive(<span class="literal">false</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Red.SetActive(<span class="literal">false</span>);</span><br><span class="line">            Blue.SetActive(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        stateRed = !stateRed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h4><p>将相同类型的东西组合一起，形成特有功能。</p>
<p>例如：构成一辆车的轮胎，框架，发动机等。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CarBase</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Forward</span>()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Backword</span>()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Wheel</span>: <span class="title">CarBase</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Forward</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Backword</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Engine</span>: <span class="title">CarBase</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Forward</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Backword</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Main</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    List&lt;CarBase&gt; car;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line">        car = <span class="keyword">new</span> List&lt;CarBase&gt;();</span><br><span class="line">        car.Add(<span class="keyword">new</span> Engine());</span><br><span class="line">        car.Add(<span class="keyword">new</span> Wheel());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; car.Count; i++)&#123;</span><br><span class="line">            car[i].Forward();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="状态者模式"><a href="#状态者模式" class="headerlink" title="状态者模式"></a>状态者模式</h4><p>FSM 有限状态机或命令者模式。</p>
<p>可以用来制作动画。</p>
<p>模型文件：<br>Obj 只有模型（顶点，法线，切线），没有动画。<br>Fbx 带动画和模型<br>Dae 只有模型</p>
<p>这里用Fbx文件。</p>
<p>模型系统：<br>Scale Factor：缩放因子，Unity以米为单位，因此需要缩放。<br>Mesh Compression<br>Read Write Enable<br>Optimize Mesh：优化，采用四边形<br>Import BlendShapes</p>
<p>Normals：法线，Import，模型自带法线<br>Tangents：切线（切线：右向量，副切线：前向量），Import，自带</p>
<p>Materials：导入材质</p>
<p>动画系统：<br>关节动画：骨骼（子级在父级的坐标 Transform）动画。</p>
<ul>
<li>MeshFilter 筛选定点</li>
<li>MeshRender 渲染选出的的定点<br>蒙皮动画：皮肤动画。</li>
<li>SkinMeshRender 将模型传递给GPU<br>顶点动画：对模型的顶点做动画。</li>
</ul>
<p>Rig<br>动画类型：</p>
<ul>
<li>Legacy 关节动画，通过代码控制</li>
<li>Generic 状态机动画，非人形动画，动画不能通用</li>
<li>Humanoid 状态机动画，人形动画，可以复用动画<ul>
<li>OrcAvatar：保存人物动画的映射</li>
</ul>
</li>
</ul>
<p>一般模型，动画分开两个文件保存。</p>
<p>动画文件，一般都是原地动画，也有带位移的动画。</p>
<p>动画事件通过代码实现。</p>
<p>fbx和meta文件一起放入目录。</p>
<p>控制器代码：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OrcCtrl</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    CharacterController charCtrl;</span><br><span class="line">    Animator animator;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnAnimatorMove</span>()</span>&#123;</span><br><span class="line">        <span class="comment">// 有重力，参数为动画片段的位移</span></span><br><span class="line">        charCtrl.SimpleMove(animator.deltaPosition); </span><br><span class="line">        charCtrl.SimpleMove(animator.deltaRotation); </span><br><span class="line">        charCtrl.SimpleMove(animator.rootPosition); </span><br><span class="line">        <span class="comment">// 没有重力，参数为向前移动</span></span><br><span class="line">        charCtrl.Move(Vector3.forward);       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line">        charCtrl = GetComponent&lt;CharacterController&gt;();</span><br><span class="line">        animator = GetComponent&lt;Animator&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Shader"><a href="#Shader" class="headerlink" title="Shader"></a>Shader</h2><h3 id="开发语言和工具"><a href="#开发语言和工具" class="headerlink" title="开发语言和工具"></a>开发语言和工具</h3><p>开发语言：<br>HLSL：专用于Direct3D和XNA。<br>Cg：C for Graphics，由NVIDIA开发<br>GLSL：用于OpenGL<br>ShaderLab：Unity使用，类似CgFX和Direct3D的效果框架。</p>
<p>开发工具：<br>FX Composer<br>Render Monkey<br>MonoDevelop：Unity使用<br>第三方IDE</p>
<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><h3 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h3><p>UDP：传输顺序不一定。<br>RUDP：保证顺序一定的UDP，发送数据后等待却认。<br>TCP：消耗资源较大，有拥塞控制。</p>
<p>MMORPG：多人在线游戏，状态同步，实时同步状态（发送状态而不是位置）到所有客户端。网络延迟时，每3-5秒同步一次。网络掉线时，重连，可以用Unity 的API判断。<br>Moba：采用RUDP，使用网络帧同步，50ms - 60ms 一次。使用Lock Step技术，服务器等待所有结果，一台机器卡，所有机器都卡。使用乐观锁，不等待客户端，只下发。<br>ARPG：角色扮演<br>PVP：对战<br>PVE：打怪<br>SLG：策略游戏</p>
<h3 id="创建连接"><a href="#创建连接" class="headerlink" title="创建连接"></a>创建连接</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line">    Socket server = <span class="keyword">new</span> Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</span><br><span class="line">    IPEndPoint endPoint = <span class="keyword">new</span> IPEndPoint(IPAddress.Parse(<span class="string">&quot;192.168.1.1&quot;</span>), <span class="number">8000</span>);</span><br><span class="line">    IPEndPoint endPoint = <span class="keyword">new</span> IPEndPoint(IPAddress.Any, <span class="number">8000</span>);</span><br><span class="line">    server.Bind(endPoint);</span><br><span class="line">    Thread thread = <span class="keyword">new</span> Thread(() =&gt; &#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                server.BeginAccept((IAsyncResult callback) =&gt; &#123;</span><br><span class="line">                    <span class="comment">// 有连接 会回调这里</span></span><br><span class="line">                    Socket client = server.EndAccept(callback);</span><br><span class="line">                &#125;, <span class="literal">null</span>); <span class="comment">// 异步，参数</span></span><br><span class="line">            &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                Debug.Log(e.ToString());</span><br><span class="line">            &#125;</span><br><span class="line">            Thread.Sleep(<span class="number">50</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    thread.Start();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 传输数据，转换二进制流或JSON</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Use</span>()</span>&#123;</span><br><span class="line">    WebCamDevice cam = WebCamTexture.devices[<span class="number">0</span>];</span><br><span class="line">    WebCamTexture tex = <span class="keyword">new</span> WebCamTexture(cam.name, <span class="number">300</span>, <span class="number">400</span>, <span class="number">10</span>); <span class="comment">// 尺寸，帧率</span></span><br><span class="line">    transform.GetComponent&lt;Renderer&gt;().material.mainTexture = tex;</span><br><span class="line">    tex.Play();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="built_in">byte</span>[] <span class="title">GetBytes</span>()</span>&#123;</span><br><span class="line">    Texture2D raw = <span class="keyword">new</span> Texture2D(<span class="number">300</span>, <span class="number">400</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i...)&#123;</span><br><span class="line">        <span class="keyword">for</span>()&#123;</span><br><span class="line">            Color c = tex.GetPixel(j, i);</span><br><span class="line">            raw.SetPixel(j, i, c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> raw.EncodeToJPG();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Send</span>()</span>&#123;</span><br><span class="line">    UDPSocket send = <span class="keyword">new</span> UDPSocket(port, size, <span class="keyword">new</span> UDPSocket.RecvDelegate(()=&gt;&#123;</span><br><span class="line">        send.SendBytes(GetBytes(), <span class="string">&quot;ip&quot;</span>);</span><br><span class="line">    &#125;));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// API</span></span><br><span class="line">Buffer.BlockCopy();</span><br><span class="line"><span class="comment">// 线程传数据</span></span><br><span class="line"><span class="comment">// 主 到 辅：主线程锁住，变换</span></span><br><span class="line"><span class="comment">// 辅 到 主：recvBuffer锁住，接收数据</span></span><br></pre></td></tr></table></figure>

<p>接收后更新M层数据，在主线程。</p>
<h2 id="示例模块"><a href="#示例模块" class="headerlink" title="示例模块"></a>示例模块</h2><p>一个游戏一般包含：</p>
<ul>
<li>Audio 音效</li>
<li>WWW 网络链接&#x2F;本地资源文件</li>
<li>DB 数据库</li>
<li>Effect 特效</li>
<li>UI 用户界面</li>
<li>Animation 动画（FSM 有限自动机）<ul>
<li>Player 玩家</li>
<li>NPC 机器人</li>
</ul>
</li>
</ul>
<h3 id="网络传输模块"><a href="#网络传输模块" class="headerlink" title="网络传输模块"></a>网络传输模块</h3><p>例如进入游戏之后，先检查游戏更新。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestHttp</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    <span class="comment">// GET 请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerator <span class="title">SendGet</span>(<span class="params"><span class="built_in">string</span> url</span>)</span>&#123;</span><br><span class="line">        WWW www = <span class="keyword">new</span> WWW(url);</span><br><span class="line">        <span class="comment">// 协程，将任务分片加载</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> www;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断是否下载错误</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">string</span>.IsNullOrEmpty(www.error))&#123;</span><br><span class="line">            <span class="comment">// 没有错误</span></span><br><span class="line">            Debug.Log(www.txt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// POST 请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerator <span class="title">SendPost</span>(<span class="params"><span class="built_in">string</span> url, WWWForm form</span>)</span>&#123;</span><br><span class="line">        WWW www = <span class="keyword">new</span> WWW(url, form);</span><br><span class="line">        <span class="comment">// 协程，将任务分片加载</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> www;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断是否下载错误</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">string</span>.IsNullOrEmpty(www.error))&#123;</span><br><span class="line">            <span class="comment">// 没有错误</span></span><br><span class="line">            Debug.Log(www.txt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下载本地文件</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerator <span class="title">DownloadLocalFile</span>(<span class="params"><span class="built_in">string</span> url</span>)</span>&#123;</span><br><span class="line">        WWW www = <span class="keyword">new</span> WWW(url, form);</span><br><span class="line">        <span class="comment">// 协程，将任务分片加载</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> www;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断是否下载错误</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">string</span>.IsNullOrEmpty(www.error))&#123;</span><br><span class="line">            <span class="comment">// 没有错误</span></span><br><span class="line">            Debug.Log(www.txt);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">InitUrl</span>(<span class="params"><span class="built_in">string</span> url</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// iOS: &quot;file://&quot;</span></span><br><span class="line">        <span class="comment">// Android: &quot;jar:file://&quot;</span></span><br><span class="line">        <span class="comment">// PC: &quot;file:///&quot;</span></span><br><span class="line">        <span class="keyword">if</span>(Application.platform == RuntimePlatform.WindowsEditor</span><br><span class="line">        || Application.platform == RuntimePlatform.WindowsPlayer)&#123;</span><br><span class="line">            url = <span class="string">&quot;file:///&quot;</span> + url;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(Application.platform == RuntimePlatform.Android)&#123;</span><br><span class="line">            url = <span class="string">&quot;jar:file://&quot;</span> + url;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            url = <span class="string">&quot;file://&quot;</span> + url;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line">        <span class="built_in">string</span> url = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="comment">// 启动协程</span></span><br><span class="line">        StartCoroutine(SendGet(url));</span><br><span class="line">        </span><br><span class="line">        WWWForm form = <span class="keyword">new</span> WWWForm();</span><br><span class="line">        form.AddField(<span class="string">&quot;arg&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">        StartCoroutine(SendPost(url, form));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Application.dataPath: 应用路径/Asserts/，一般只读，访问工程，只在PC上</span></span><br><span class="line">        <span class="comment">// Application.persistentDataPath: 缓存路径，用文件系统可读可写</span></span><br><span class="line">        <span class="comment">//    Android：SD 卡</span></span><br><span class="line">        <span class="comment">//    iOS：Document</span></span><br><span class="line">        <span class="comment">//    Android：User/AppData/Local...</span></span><br><span class="line">        <span class="comment">// Application.streamingAssetsPath: 应用路径/Asserts/StreamingAsserts，该路径下所有文件会被打包到实机上（打包后的assets路径下，只能用www下载，不可写）</span></span><br><span class="line">        <span class="built_in">string</span> filepath = Application.dataPath + <span class="string">&quot;/filename.txt&quot;</span>;</span><br><span class="line">        StartCoroutine(DownloadLocalFile(InitUrl(filepath)))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>封装模块：</p>
<p>下载任务基类：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WWWItem</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">BeginDownload</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">DownlaodFinish</span>(<span class="params">WWW www</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">DownloadError</span>(<span class="params">WWWItem item</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> url;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Url&#123;</span><br><span class="line">        <span class="keyword">get</span> &#123;<span class="keyword">return</span> url;&#125;</span><br><span class="line">        <span class="keyword">set</span> &#123;url = <span class="keyword">value</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerator <span class="title">Download</span>()</span>&#123;</span><br><span class="line">        BeginDownload();</span><br><span class="line">        WWW www = <span class="keyword">new</span> WWW(Url);</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> www;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">string</span>.IsNullOrEmpty(www.error))&#123;</span><br><span class="line">            DownlaodFinish(www);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            DownloadError(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下载队列：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WWWHelper</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> WWWHelper Instance;</span><br><span class="line"></span><br><span class="line">    Queue&lt;WWWItem&gt; allTask;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line">        Instance = <span class="keyword">this</span>;</span><br><span class="line">        allTask = <span class="keyword">new</span> Queue&lt;WWWItem&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddTask</span>(<span class="params">WWWItem item</span>)</span>&#123;</span><br><span class="line">        allTask.Enqueue(item);</span><br><span class="line">        <span class="keyword">if</span>(allTask.Count == <span class="number">1</span>)&#123;</span><br><span class="line">            StartCoroutine(DownloadItems());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerator <span class="title">DownloadItems</span>()</span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(allTask.Count &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            WWWItem item = allTask.Dqeueue();</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">return</span> item.Download();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下载TXT文件模块：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WWWTxt</span>: <span class="title">WWWItem</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WWWText</span>(<span class="params"><span class="built_in">string</span> url</span>)</span>&#123;</span><br><span class="line">        url = InitUrl(url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">InitUrl</span>(<span class="params"><span class="built_in">string</span> url</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(Application.platform == RuntimePlatform.WindowsEditor</span><br><span class="line">        || Application.platform == RuntimePlatform.WindowsPlayer)&#123;</span><br><span class="line">            url = <span class="string">&quot;file:///&quot;</span> + url;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(Application.platform == RuntimePlatform.Android)&#123;</span><br><span class="line">            url = <span class="string">&quot;jar:file://&quot;</span> + url;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            url = <span class="string">&quot;file://&quot;</span> + url;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">BeginDownload</span>()</span>&#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;Start ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">DownlaodFinish</span>(<span class="params">WWW www</span>)</span>&#123;</span><br><span class="line">        Debug.Log(www.txt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">DownloadError</span>(<span class="params">WWWItem item</span>)</span>&#123;</span><br><span class="line">        WWWHelper.Instance.AddTast(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> url = Application.dataPath + <span class="string">&quot;/filename&quot;</span>;</span><br><span class="line">WWWTxt txtTask = <span class="keyword">new</span> WWWTxt(url);</span><br><span class="line">WWWHelper.Instance.AddTask(txtTask);</span><br></pre></td></tr></table></figure>

<h3 id="音效模块"><a href="#音效模块" class="headerlink" title="音效模块"></a>音效模块</h3><p>需要监听者，声源。</p>
<p>Audio Listener：相当于摄像机，唯一。</p>
<p>Audio Source：可以播放Audio Clip，非常占用空间，继承MonoBehavior，属性较多。</p>
<h2 id="因此：-应该使用有限个Audio-Source播放所有Clips（对象池）"><a href="#因此：-应该使用有限个Audio-Source播放所有Clips（对象池）" class="headerlink" title="因此：- 应该使用有限个Audio Source播放所有Clips（对象池）"></a>因此：<br>- 应该使用有限个Audio Source播放所有Clips（对象池）</h2><p>Audio 模块：</p>
<ul>
<li>SourceManager：管理AudioSoruce对象，寻找空闲的对象，播放Clip<ul>
<li>拿出空闲的Audio Source</li>
<li>释放空闲的Audio Source</li>
<li>播放或停止播放</li>
</ul>
</li>
<li>AudioSoruce：3个</li>
<li>ClipsManager：管理Clip对象<ul>
<li>有名字作为索引</li>
<li>通过配置文件读取</li>
<li>加载到内存</li>
</ul>
</li>
<li>Clip：无数个</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AudioManger</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AudioManger Instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SourceManager sourceManager;</span><br><span class="line">    <span class="keyword">private</span> ClipManager clipManager;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line">        Instance = <span class="keyword">this</span>;</span><br><span class="line">        sourceManager = <span class="keyword">new</span> SourceManager(gameObject);</span><br><span class="line">        clipManager = <span class="keyword">new</span> ClipManager();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Play</span>(<span class="params"><span class="built_in">string</span> audioName</span>)</span>&#123;</span><br><span class="line">        AudioSource source = sourceManage.GetFreeAudio();</span><br><span class="line">        SingleClip singleClip = clipManager.FindClipByName(audioName);</span><br><span class="line">        singleClip.Play(source);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Stop</span>(<span class="params"><span class="built_in">string</span> audioName</span>)</span>&#123;</span><br><span class="line">        sourceManager.Stop(audioName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SourceManager</span>&#123;</span><br><span class="line">    List&lt;AudioSource&gt; allSources;</span><br><span class="line">    GameObject owner;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SourceManager</span>(<span class="params">GameObject own</span>)</span>&#123;</span><br><span class="line">        owner = own;</span><br><span class="line">        InitAudioSourceList();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InitAudioSourceList</span>()</span>&#123;</span><br><span class="line">        allSources = <span class="keyword">new</span> List&lt;AudioSource&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">            AudioSource source = owner.AddComponent&lt;AudioSource&gt;();</span><br><span class="line">            allSources.Add(source);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AudioSource <span class="title">GetFreeAudio</span>()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;allSources.Count;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!allSources[i].isPlaying)&#123;</span><br><span class="line">                <span class="keyword">return</span> allSources[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        AudioSource source = owner.AddComponent&lt;AudioSouce&gt;();</span><br><span class="line">        allSources.Add(source);</span><br><span class="line">        <span class="keyword">return</span> source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReleaseFreeAudio</span>()</span>&#123;</span><br><span class="line">        <span class="built_in">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        List&lt;AudioSource&gt; releaseSources = <span class="keyword">new</span> List&lt;AudioSource&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;allSources.Count;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!allSources[i].isPlaying)&#123;</span><br><span class="line">                cnt++;</span><br><span class="line">                <span class="keyword">if</span>(cnt &gt; <span class="number">3</span>)&#123;</span><br><span class="line">                    releaseSources.Add(allSources[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;releaseSources.Count;i++)&#123;</span><br><span class="line">            allSources.Remove(releaseSources[i]);</span><br><span class="line">            GameObject.Destroy(releaseSources[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        releaseSources.Clear();</span><br><span class="line">        releaseSources = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Stop</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;allSources.Count;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(allSources[i].isPlaying &amp;&amp;</span><br><span class="line">            allSources[i].clip.name.Equals(name))&#123;</span><br><span class="line">                allSources[i].Stop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ClipManager</span>&#123;</span><br><span class="line">    <span class="comment">// 从配置文件加载</span></span><br><span class="line">    <span class="built_in">string</span>[] clipName = <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">string</span>[] clipFile = <span class="literal">null</span>;</span><br><span class="line">    <span class="built_in">int</span> clipCount = <span class="number">0</span>; </span><br><span class="line"></span><br><span class="line">    SingleClip[] allSingleClip;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ClipManager</span>()</span>&#123;</span><br><span class="line">        ReadConfigFile();</span><br><span class="line">        LoadClips();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReadConfigFile</span>()</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> fileAddress = Application.streamingAssertsPath + <span class="string">&quot;/AudioConfig.txt&quot;</span>;</span><br><span class="line">        FileInfo info = <span class="keyword">new</span> FileInfo(fileAddress);</span><br><span class="line">        <span class="keyword">if</span>(info.Exists)&#123;</span><br><span class="line">            <span class="keyword">with</span>()</span><br><span class="line">            StreamReader sr = <span class="keyword">new</span> StreamReader(fileAddress);</span><br><span class="line">            <span class="built_in">string</span> lineCountStr = sr.ReadLine();</span><br><span class="line">            <span class="built_in">int</span> lineCount = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">int</span>.TryParse(lineCountStr, <span class="keyword">out</span> lineCount))&#123;</span><br><span class="line">                clipName = <span class="keyword">new</span> <span class="built_in">string</span>[lineCount];</span><br><span class="line">                clipFile = <span class="keyword">new</span> <span class="built_in">string</span>[lineCount];</span><br><span class="line">                <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;lineCount;i++)&#123;</span><br><span class="line">                    <span class="built_in">string</span>[] line = sr.ReadLine().Split(<span class="string">&quot;\t&quot;</span>.ToCharArray());</span><br><span class="line">                    clipName[i] = line[<span class="number">0</span>];</span><br><span class="line">                    clipFile[i] = line[<span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">// Read Error</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LoadClips</span>()</span>&#123;</span><br><span class="line">        allSingleClip = <span class="keyword">new</span> SingleClip[clipCount];</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;clipCount;i++)&#123;</span><br><span class="line">            AudioClip clip = Resources.Load&lt;AudioClip&gt;(clipFile[i]);</span><br><span class="line">            SingleClip sclip = <span class="keyword">new</span> SingleClip(clip);</span><br><span class="line">            allSingleClip[i] = sclip;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SingleClip <span class="title">FindClipByName</span>(<span class="params"><span class="built_in">string</span> name</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;clipCount;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(clipName[i] == name)&#123;</span><br><span class="line">                <span class="keyword">return</span> allSingleClip[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>配置文件<code>AudioConfig.txt</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">ClipButton  ClipButton.mp3</span><br><span class="line">River   River.mp3</span><br><span class="line">UIMusic UIMusic.mp3</span><br></pre></td></tr></table></figure>


<p>Clip 存储：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingleClip</span>&#123;</span><br><span class="line">    AudioClip clip;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SingleClip</span>(<span class="params">AudioClip tclip</span>)</span>&#123;</span><br><span class="line">        clip = tclip;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Play</span>(<span class="params">AudioSource source</span>)</span>&#123;</span><br><span class="line">        source.clip = clip;</span><br><span class="line">        source.play();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="UI-模块"><a href="#UI-模块" class="headerlink" title="UI 模块"></a>UI 模块</h3><p>从效果图入手，切图成为碎图。<br>使用Texture Packer打大图：</p>
<p>Data Format：Unity Texture2D<br>Texture format：PNG<br>Image format：RGBA8888: 每个通道8bit。</p>
<p>Geometry<br>Max Size：<code>2048*2048 (1024*1024)</code></p>
<p>其他保持默认，然后将碎图文件夹拖入其中，得到拼图（tpsheet）</p>
<p>在Unity中，加载插件<code>codeandweb.com</code>放入根目录。</p>
<p>之后根据拼图拼UI，以Panel为单位。</p>
<p>使用时，使用九宫格拉伸。</p>
<p>最后写代码：</p>
<p>Controller:<br>UIManager管理所有Panel及其子控件。<br>Panel包含部分子控件。<br>子控件消息通信通过UIManager直接查询对方。<br>子控件主动报告数据。</p>
<p>子控件设计：实现UIBehaviour，实现向UIManager注册自己<br>UIManager：被注册后，以Panel为单位划分，挂载子控件。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIBehaviour</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>()</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> panel = transform.GetComponentInParent&lt;UIBase&gt;();</span><br><span class="line">        UIManager.Instance.RegistGameObject(panel, transform.name, gameObject)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddButtonListener</span>(<span class="params">UnityAction action</span>)</span>&#123;</span><br><span class="line">        Button btn = transform.GetComponent&lt;Button&gt;();</span><br><span class="line">        <span class="keyword">if</span>(btn != <span class="literal">null</span>)&#123;</span><br><span class="line">            btn.onClick.AddListener(action);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddDragInterface</span>(<span class="params">UnityAction&lt;BaseEventData&gt; action</span>)</span>&#123;</span><br><span class="line">        EventTrrigger trigger = gameObject.GetComponent&lt;EventTrigger&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(trigger == <span class="literal">null</span>)&#123;</span><br><span class="line">            trigger = gameObject.AddComponent&lt;EventTrigger&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        EventTrigger.Entry entry = EventTrigger.Entry();</span><br><span class="line">        entry.eventID = EventTriggerType.Drag;</span><br><span class="line">        entry.callback = <span class="keyword">new</span> EventTrigger.TriggerEvent();</span><br><span class="line">        entry.callback.AddListener(action);</span><br><span class="line">        trigger.triggers.Add(entry);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIBase</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>()</span>&#123;</span><br><span class="line">        Transform[] allChd = transform.GetComponentsInChildren&lt;Transform&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;allChd.Lenght;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(allChd[i].name.EndsWith(<span class="string">&quot;_N&quot;</span>))&#123;</span><br><span class="line">                allChd[i].gameObject.AddComponent&lt;UIBehaviour&gt;();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDestory</span>()</span>&#123;</span><br><span class="line">        UIManager.Instance.UnRegistPanel(transform.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> GameObject <span class="title">GetWidget</span>(<span class="params"><span class="built_in">string</span> widget</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UIManager.Instance.GetWidget(transform.name, widget);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UIBehaviour <span class="title">GetBehaviour</span>(<span class="params"><span class="built_in">string</span> widget</span>)</span>&#123;</span><br><span class="line">        GameObject obj = GetWidget(widget);</span><br><span class="line">        <span class="keyword">if</span>(obj != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> obj.GetComponent&lt;UIBehaviour&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddButtonListener</span>(<span class="params"><span class="built_in">string</span> widget, UnityAction action</span>)</span>&#123;</span><br><span class="line">        UIBehaviour bvr = GetBehaviour(widget);</span><br><span class="line">        <span class="keyword">if</span>(bvr != <span class="literal">null</span>)&#123;</span><br><span class="line">            bvr.AddButtonListener(action);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddDrag</span>(<span class="params"><span class="built_in">string</span> widget, UnityAction&lt;BaseEventData&gt; action</span>)</span>&#123;</span><br><span class="line">        UIBehaviour bvr = GetBehaviour(widget);</span><br><span class="line">        <span class="keyword">if</span>(bvr != <span class="literal">null</span>)&#123;</span><br><span class="line">            bvr.AddDragInterface(action);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UIManager</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UIManager Instance;</span><br><span class="line">    <span class="comment">// 第一级表示Panel，第二级表示子控件</span></span><br><span class="line">    Dictionary&lt;<span class="built_in">string</span>, Dictionary&lt;<span class="built_in">string</span>, GameObject&gt;&gt; allWidgets;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RegistGameObject</span>(<span class="params"><span class="built_in">string</span> panel, <span class="built_in">string</span> widget, GameObject obj</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(allWidgets.ContainsKey(panel))&#123;</span><br><span class="line">            allWidgets[panel] = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, Dictionary&lt;<span class="built_in">string</span>, GameObject&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        allWidgets[panel].Add(widget, obj)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UnRegistGameObject</span>(<span class="params"><span class="built_in">string</span> panel, <span class="built_in">string</span> widget, GameObject obj</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(allWidgets.ContainsKey(panel))&#123;</span><br><span class="line">            <span class="keyword">if</span>(allWidgets[panel].ContainsKey(widget))&#123;</span><br><span class="line">                allWidgets[panel].Remove(widget);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">UnRegistPanel</span>(<span class="params"><span class="built_in">string</span> panel</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(allWidgets.ContainsKey(panel))&#123;</span><br><span class="line">            allWidgets[panel].Clear();</span><br><span class="line">            allWidgets[panel] = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> GameObject <span class="title">GetWidget</span>(<span class="params"><span class="built_in">string</span> panel, <span class="built_in">string</span> widget</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(allWidgets.ContainsKey(panel))&#123;</span><br><span class="line">            <span class="keyword">return</span> allWidgets[panel][widget];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>()</span>&#123;</span><br><span class="line">        Instance = <span class="keyword">this</span>;</span><br><span class="line">        allWidgets = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, Dictionary&lt;<span class="built_in">string</span>, GameObject&gt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Regist</span>: <span class="title">UIBase</span>&#123;</span><br><span class="line">    RegistModel registModel;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnClick</span>()</span>&#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span>&#123;</span><br><span class="line">        AddButtonListener(<span class="string">&quot;btn_N&quot;</span>, OnClick);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Model:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RegistModel</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> username;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>资源加载：<br>在Loading界面，要将资源加载到内存。用的时候再实例化。</p>
<p>在列表类的控件，会在子控件加载多个同类型的子单元控件。因此需要批量加载初始化。</p>
<p>现在让子控件称为UISubManager，来管理下级单位。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UISubManager</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    Dictionary&lt;<span class="built_in">string</span>, GameObject&gt; allChd;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>()</span>&#123;</span><br><span class="line">        UIBase bs = transform.GetComponetInParent&lt;UIBase&gt;();</span><br><span class="line">        UIManager.Instance.RegistGameObject(,)</span><br><span class="line"></span><br><span class="line">        Transform[] chd = transform.GetComponentsInChildren&lt;Transform&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">0</span>;i&lt;chd.Length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(chd[i].name.EndsWith(<span class="string">&quot;_S&quot;</span>))&#123;</span><br><span class="line">                allChd.Add(chd[i].name, chd[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Transform <span class="title">GetChidTransform</span>(<span class="params"><span class="built_in">string</span> widget</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> allChd[widget];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDestory</span>()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(allChd != <span class="literal">null</span>)&#123;</span><br><span class="line">            allChd.Clear();</span><br><span class="line">            allChd = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="摇杆-EasyTouch"><a href="#摇杆-EasyTouch" class="headerlink" title="摇杆 EasyTouch"></a>摇杆 EasyTouch</h3><p>首先获取鼠标到圆心的距离，与方向。<br>考虑移动范围：圆内任意移动，不可超出圆。</p>
<h3 id="小地图"><a href="#小地图" class="headerlink" title="小地图"></a>小地图</h3><p>可以使用相机，修改属性：<br>Viewport Rect：显示在屏幕上的位置和大小<br>Depth：相机前后关系</p>
<p>但是以上方法渲染两次，消耗资源。</p>
<p>因此可以使用等比例映射，也就是用图片做小地图。</p>
<p>创建一张图片，使其（锚点）对齐到右上角。</p>
<p>然后让物体的位置映射到小地图上。</p>
<p>物体相对于地形的位置，按照比例缩小到小地图。</p>
<h3 id="GL"><a href="#GL" class="headerlink" title="GL"></a>GL</h3><p>GL.PushMatrix()<br>位置变换 GL.MultMatrix(transform.localToWorldMatrix)<br>正交投影 GL.LoadOrtho()<br>画线 GL.Begin(GL.LINES)<br>也可以画三角形，多边形等。<br>颜色 GL.Color(Color.red)<br>位置 GL.Vertex3(0.1f, 0.1f, 0)<br>结束 GL.End()<br>GL.PopMatrix()</p>
<h3 id="小地图上的摄像机可视区域"><a href="#小地图上的摄像机可视区域" class="headerlink" title="小地图上的摄像机可视区域"></a>小地图上的摄像机可视区域</h3><p>得到相机的可视区域，映射到小地图上面。</p>
<p>将相机的四个角对应到世界位置上：从相机的四个角发出4条射线到地面，得到4个交点。再映射到小地图。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CameraView</span>: <span class="title">MonoBehaviour</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span>&#123;</span><br><span class="line">        Ray first = Camera.main.ViewportPointToRay(Vector3.zero);</span><br><span class="line">        Ray second = Camera.main.ViewportPointToRay(Vector3.right);</span><br><span class="line">        Ray third = Camera.main.ViewportPointToRay(Vector3.one);</span><br><span class="line">        Ray forth = Camera.main.ViewportPointToRay(Vector3.up);</span><br><span class="line"></span><br><span class="line">        RaycastHit hitout;</span><br><span class="line">        <span class="keyword">if</span>(Physics.Raycast(first, <span class="keyword">out</span> hitout, <span class="number">1000</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span>(hitout.transform.CompareTag(<span class="string">&quot;Ground&quot;</span>))&#123;</span><br><span class="line">                <span class="comment">// 得到世界坐标</span></span><br><span class="line">                hitout.point</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



















    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Unity-3D/" rel="tag"># Unity 3D</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2020/03/14/%E6%B8%B8%E6%88%8F/3dmaxExec/" rel="prev" title="3D 建模与引擎">
                  <i class="fa fa-angle-left"></i> 3D 建模与引擎
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2020/03/24/%E5%89%8D%E7%AB%AF/WechatProgram/" rel="next" title="微信小程序">
                  微信小程序 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Peng</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  

  <a href="https://github.com/withz" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.12/pdfobject.min.js","integrity":"sha256-g2xji1rlE3KsGVClvuxTbcR0Kn2+wtQADSff2Tbb4zA="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":false,"delay":true,"timeout":3000,"priority":true,"url":"https://withz.github.io/2020/03/18/%E6%B8%B8%E6%88%8F/Unity3d/"}</script>
  <script src="/js/third-party/quicklink.js"></script>

</body>
</html>
